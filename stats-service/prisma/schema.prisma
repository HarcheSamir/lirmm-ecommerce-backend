// stats-service/prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Kpi {
  key   String  @id
  value Decimal @db.Decimal(18, 2)
  label String
}

model MonthlyAggregate {
  year          Int
  month         Int
  totalRevenue  Decimal @default(0) @db.Decimal(18, 2)
  totalExpenses Decimal @default(0) @db.Decimal(18, 2)
  newOrders     Int     @default(0)
  newCustomers  Int     @default(0)

  @@id([year, month])
}

// --- START: SURGICAL ADDITION ---
model DailyAggregate {
  date         DateTime @id @db.Date
  newCustomers Int      @default(0)
  newOrders    Int      @default(0)
  totalRevenue Decimal  @default(0) @db.Decimal(18, 2)
}
// --- END: SURGICAL ADDITION ---

model ProductPerformance {
  variantId             String  @id
  productId             String
  productName           Json
  variantAttributes     Json
  totalQuantitySold     Int     @default(0)
  totalRevenueGenerated Decimal @default(0) @db.Decimal(18, 2)

  @@index([productId])
  @@index([totalRevenueGenerated])
}